<tal:block tal:define="dummy python:request.set('disable_border', True)"/><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      lang="en"
      metal:use-macro="context/main_template/macros/master"
      i18n:domain="plone">

<body>

<metal:main fill-slot="main">
    <h1 class="documentFirstHeading">Shipping</h1>

    <tal:form metal:use-macro="context/@@ploneform-macros/titlelessform">
      <tal:fields metal:fill-slot="fields">

        <div class="form-left">
          <fieldset>
            <legend>Shipping Address</legend>
            <tal:block tal:replace="structure view/widgets/first_name/@@ploneform-render-widget" />
            <tal:block tal:replace="structure view/widgets/last_name/@@ploneform-render-widget" />
            <tal:block tal:replace="structure view/widgets/street/@@ploneform-render-widget" />
            <tal:block tal:replace="structure view/widgets/city/@@ploneform-render-widget" />
            <tal:block tal:replace="structure view/widgets/state/@@ploneform-render-widget" />
            <select id="state-select" class="pat-select2" style="display: none;">
              <option value=""></option>
              <option value="AL">Alabama</option>
              <option value="AK">Alaska</option>
              <option value="AZ">Arizona</option>
              <option value="AR">Arkansas</option>
              <option value="CA">California</option>
              <option value="CO">Colorado</option>
              <option value="CT">Connecticut</option>
              <option value="DE">Delaware</option>
              <option value="DC">District Of Columbia</option>
              <option value="FL">Florida</option>
              <option value="GA">Georgia</option>
              <option value="HI">Hawaii</option>
              <option value="ID">Idaho</option>
              <option value="IL">Illinois</option>
              <option value="IN">Indiana</option>
              <option value="IA">Iowa</option>
              <option value="KS">Kansas</option>
              <option value="KY">Kentucky</option>
              <option value="LA">Louisiana</option>
              <option value="ME">Maine</option>
              <option value="MD">Maryland</option>
              <option value="MA">Massachusetts</option>
              <option value="MI">Michigan</option>
              <option value="MN">Minnesota</option>
              <option value="MS">Mississippi</option>
              <option value="MO">Missouri</option>
              <option value="MT">Montana</option>
              <option value="NE">Nebraska</option>
              <option value="NV">Nevada</option>
              <option value="NH">New Hampshire</option>
              <option value="NJ">New Jersey</option>
              <option value="NM">New Mexico</option>
              <option value="NY">New York</option>
              <option value="NC">North Carolina</option>
              <option value="ND">North Dakota</option>
              <option value="OH">Ohio</option>
              <option value="OK">Oklahoma</option>
              <option value="OR">Oregon</option>
              <option value="PA">Pennsylvania</option>
              <option value="RI">Rhode Island</option>
              <option value="SC">South Carolina</option>
              <option value="SD">South Dakota</option>
              <option value="TN">Tennessee</option>
              <option value="TX">Texas</option>
              <option value="UT">Utah</option>
              <option value="VT">Vermont</option>
              <option value="VA">Virginia</option>
              <option value="WA">Washington</option>
              <option value="WV">West Virginia</option>
              <option value="WI">Wisconsin</option>
              <option value="WY">Wyoming</option>              
            </select>
            <select id="province-select" class="pat-select2" style="display: none;">
              <option value=""></option>
              <option value="AB">Alberta</option>
              <option value="BC">British Columbia</option>
              <option value="MB">Manitoba</option>
              <option value="NB">New Brunswick</option>
              <option value="NL">Newfoundland and Labrador</option>
              <option value="NS">Nova Scotia</option>
              <option value="ON">Ontario</option>
              <option value="PE">Prince Edward Island</option>
              <option value="QC">Quebec</option>
              <option value="SK">Saskatchewan</option>
              <option value="NT">Northwest Territories</option>
              <option value="NU">Nunavut</option>
              <option value="YT">Yukon</option>
            </select>
            <tal:block tal:replace="structure view/widgets/postal_code/@@ploneform-render-widget" />
            <tal:block tal:replace="structure view/widgets/country/@@ploneform-render-widget" />
          </fieldset>

        </div>
        <div class="form-left">
          <fieldset>
            <legend>Shipping Method</legend>
            <div id="shipping-method" tal:content="structure view/shipping_methods_template" />
          </fieldset>
        </div>

      </tal:fields>

      <tal:actions metal:fill-slot="actions" />
    </tal:form>

    <script>
    jQuery(function($) {
      var $form = $('#form');
      var $street = $('input[name="form.widgets.street"]');
      var $city = $('input[name="form.widgets.street"]');
      var $state_text = $('input[name="form.widgets.state"]');
      var $state_select = $('#state-select');
      var $prov_select = $('#province-select');
      var $zip = $('input[name="form.widgets.street"]');
      var $country = $('select[name="form.widgets.country"]');

      var update_states = function() {
        var $state_select2 = $('#s2id_state-select');
        var $prov_select2 = $('#s2id_province-select');
        if ($country.val() == 'United States') {
          $state_text.attr('name', null).hide();
          $prov_select.attr('name', null)
          $prov_select2.hide();
          $state_select.attr('name', 'form.widgets.state');
          $state_select.val($state_text.val()).trigger('change');
          $state_select2.show();
        } else if ($country.val() == 'Canada') {
          $state_text.attr('name', null).hide();
          $state_select.attr('name', null);
          $state_select2.hide();
          $prov_select.attr('name', 'form.widgets.state');
          $prov_select.val($state_text.val()).trigger('change');
          $prov_select2.show();
        } else {
          $state_select.attr('name', null).hide();
          $state_select2.hide();
          $prov_select.attr('name', null).hide();
          $prov_select2.hide();
          if ($state_text.is(':hidden')) {
            $state_text.val('');
          }
          $state_text.attr('name', 'form.widgets.state').show();
        }        
      };
      var update_form = function() {
        var $state = $('[name="form.widgets.state"]');
        if ($country.val() && $state.val() && $zip.val() && $city.val() && $street.val()) {
          $('#shipping-method').load(location.href, $form.serialize() + '&update=1');
        }
      };

      $country.change(update_states);
      $('select,input', $form).change(update_form);
      setTimeout(function() { update_states(); }, 5);
      update_form();
    });
    </script>
</metal:main>
</body>
</html>
